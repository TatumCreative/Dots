var Evo=Evo||{};
Evo.CellFactory=function(){var b=function(a,b){this.scene=a;this.grid=null;this.energyGenerator=new Evo.EnergyGenerator(this.scene,this);this.random=new Evo.Random(3365);this.cells=[];this.cellStartCount=10;this.maxCells=1500;this.killDistance=100;this.scene.mouse.setDrawRadius(this.killDistance);this.setBindings();Evo.Cell.prototype.setBindings();Evo.Phenotype.prototype.setBindings();$(this.scene.canvas.el).on("mousedown",this.mouseKillCells.bind(this));$("#CellFactory-Restart").click(this.restart.bind(this));$(window).on("resize",
this.rebuildGrid.bind(this))};b.prototype={update:function(a){},draw:function(a){},generateCells:function(){for(var a,b=0;b<this.cellStartCount;b++)a=new Evo.Cell(this.scene,this.grid,this.energyGenerator,this.getStartingVector(),this.random.get()),this.animateCell(a),this.cells.push(a),a.i=b},getStartingVector:function(a){a||(a=new Evo.Vector);Evo.Vector.is2d?a.set(this.scene.canvas.width*this.random.get(),this.scene.canvas.height*this.random.get()):new a.set(250-500*this.random.get(),250-500*this.random.get(),
250-500*this.random.get());return a},restart:function(){this.killAllCells();this.generateCells()},cellIsDead:function(a){a=this.cells.indexOf(a);this.cells.splice(a,1)},rebuildGrid:function(){},killAllCells:function(){for(var a=0,b=this.cells.length;a<b;a++)this.cells[a].kill();this.cells.length=0;this.generateCells()},mouseKillCells:function(a){a&&a.preventDefault();a=this.scene.mouse.position.clone();for(var b=0,c=this.cells.length;b<c;b++)this.cells[b].position.distanceTo(a)<this.killDistance&&
(this.cells[b].kill(),this.cells.splice(b,1),c--)},animateCell:function(a){a.stateMachine.add(new Evo.States.Roam(a));a.stateMachine.add(new Evo.States.GrowAndDivide(a,this,a.phenome.get("growthRate"),2.5*a.phenome.get("birthSize")));a.stateMachine.add(new Evo.States.DieRandomly(a,this));a.stateMachine.add(new Evo.States.DieWhenCrowded(a,this));a.stateMachine.add(new Evo.States.FleeWalls(a,this.scene.canvas));Evo.Vector.is3d||a.stateMachine.add(new Evo.States.FleeMouse2d(a,this.scene.mouse,a.phenome.get("fleeSpeed"),
a.phenome.get("fleeDistance")))},divideCell:function(a){if(!(this.cells.length>this.maxCells)){var b=new Evo.Cell(this.scene,this.grid,this.energyGenerator,a.position.clone(),this.random.get());b.phenome.copy(a.phenome);a.phenome.mutate();b.phenome.mutate();a.revert();b.revert();this.animateCell(b);this.cells.push(b)}},getCellCount:function(){return this.cells.length},setBindings:function(){new Evo.Binding("startcount",function(){return this.cellStartCount}.bind(this),function(a){a=parseInt(a);this.cellStartCount=
0<a?a:1}.bind(this));new Evo.Binding("maxcells",function(){return this.maxCells}.bind(this),function(a){a=parseInt(a);this.maxCells=a=Math.min(0<a?a:1,1E4)}.bind(this));new Evo.Binding("killdistance",function(){return this.killDistance}.bind(this),function(a){a=parseInt(a);a=0<a?a:1;this.scene.mouse.setDrawRadius(a);this.killDistance=a}.bind(this))}};return b}();
Evo.Cell=function(){var b=function(a,b,c,e,f){this.scene=a;this.grid=b;this.energyGenerator=c;this.random=new Evo.Random(f);this.stateMachine=new Evo.StateMachine(f+2065);this.position=e;this.direction=new Evo.Vector(1,0,0);this.bounds=new Evo.Vector(this.scene.canvas.width,this.scene.canvas.height,1);this.age=this.speed=0;this.energy=100;this.weightedDirection=new Evo.Vector(0,0,0);this.weightedSpeed={speed:0,weight:0};Evo.Vector.is3d&&this.setup3d();this.phenome=new Evo.Phenome(f+6399);this.phenome.generate();
this.revert();Evo.Vector.is2d&&this.scene.loop.registerDraw(this);this.scene.loop.registerUpdate(this)};b.prototype={SPEEDCOST:1,setup3d:function(){var a=(this.scene.canvas.width+this.scene.canvas.height)/2;this.bounds=new Evo.Vector(a,a,a);this.geometry=new THREE.CubeGeometry(5,5,5);this.material=new THREE.MeshPhongMaterial({color:0,specular:new THREE.Color(16777215),shininess:Math.pow(10,2),emissive:new THREE.Color,shading:THREE.NoShading,wireframe:!1,wireframeLinewidth:3});this.object3d=new THREE.Mesh(this.geometry,
this.material);this.object3d.position=this.position;this.scene.scene.add(this.object3d)},kill:function(){this.scene.loop.removeDraw(this);this.scene.loop.removeUpdate(this);Evo.Vector.is3d&&this.scene.scene.remove(this.object3d);this.stateMachine.kill()},revert:function(){this.size=this.phenome.get("birthSize")/2+this.phenome.get("birthSize")/2*this.random.get();this.fillStyle=Evo.Utilities.rgbToFillstyle(this.phenome.get("color_r"),this.phenome.get("color_g"),this.phenome.get("color_b"));Evo.Vector.is3d&&
this.material.emissive.setRGB(this.phenome.get("color_r")/255,this.phenome.get("color_g")/255,this.phenome.get("color_b")/255)},addWeightedDirection:function(a,b){if(isNaN(this.weightedDirection.x))debugger;a.multiplyScalar(b);this.weightedDirection.add(a);if(isNaN(this.weightedDirection.x))debugger},addWeightedSpeed:function(a,b){this.weightedSpeed.speed+=a*b;this.weightedSpeed.weight+=b},draw:function(a){this.scene.canvas.context.beginPath();this.scene.canvas.context.fillStyle=this.fillStyle;this.scene.canvas.context.fillRect(this.position.x,
this.position.y,this.size,this.size);this.scene.canvas.context.fill()},update:function(a){this.energy+=this.energyGenerator.get();this.stateMachine.update(a);this.update_position(a);this.update_keepOnScreen(a);this.age+=a},update_position:function(a){var b=0;if(isNaN(this.weightedDirection.x))debugger;this.speed=0<this.weightedSpeed.weight?this.weightedSpeed.speed/this.weightedSpeed.weight:0;this.size-=this.speed*this.SPEEDCOST;this.size=Math.max(this.size,1);Evo.Vector.is3d&&(b=this.size/10,this.object3d.scale.set(b,
b,b));this.weightedDirection.normalize();this.direction.copy(this.weightedDirection);this.weightedDirection.multiplyScalar(a*this.speed);this.position.add(this.weightedDirection);this.weightedDirection.multiplyScalar(0);this.weightedSpeed.speed=0;this.weightedSpeed.weight=0;if(isNaN(this.position.x))debugger},update_keepOnScreen:function(a){this.position.x%=this.bounds.x;this.position.y%=this.bounds.y;this.position.z%=this.bounds.z},setBindings:function(){new Evo.Binding("speedcost",function(){return b.prototype.SPEEDCOST},
function(a){a=parseFloat(a,10);b.prototype.SPEEDCOST=a}.bind(this))}};return b}();
Evo.Phenome=function(){var b=function(a){this.random=new Evo.Random(a);this.phenotype={}};b.prototype={mutate:function(){this.phenotype.fleeSpeed.mutate(1,400);this.phenotype.fleeDistance.mutate(1,400);this.phenotype.birthSize.mutate(5,15);this.phenotype.growthRate.mutate(1E-6,0.005);this.phenotype.color_r.mutate(10,200,!0);this.phenotype.color_g.mutate(10,200,!0);this.phenotype.color_b.mutate(10,200,!0)},generate:function(){var a=this.random.get(),b=10*this.random.get()+5;this.phenotype.fleeSpeed=
new Evo.Phenotype(1E3*this.random.get()+500,a+2945);this.phenotype.color_r=new Evo.Phenotype(parseInt(200*this.random.get(),10),a+9574);this.phenotype.color_g=new Evo.Phenotype(parseInt(200*this.random.get(),10),a+2348);this.phenotype.color_b=new Evo.Phenotype(parseInt(200*this.random.get(),10),a+8975);this.phenotype.fleeDistance=new Evo.Phenotype(150*this.random.get()+180,a+2875);this.phenotype.birthSize=new Evo.Phenotype(b,a+9587);this.phenotype.growthRate=new Evo.Phenotype(0.005*this.random.get(),
a+1857)},get:function(a){return this.phenotype[a].value},copy:function(a){for(var b in a.phenotype)a.phenotype.hasOwnProperty(b)&&(this.phenotype[b].value=a.phenotype[b].value)}};return b}();
Evo.Phenotype=function(){var b=function(a,b){this.value=a;this.random=new Evo.Random(b)};b.prototype={mutationRate:0.5,mutationFactor:5,mutate:function(a,b,c){this.random.get()<this.mutationRate&&(this.value*=(0.5-this.random.get()+this.mutationFactor)/this.mutationFactor,void 0!==a&&(this.value=Math.max(this.value,a)),void 0!==b&&(this.value=Math.min(this.value,b)),c&&(this.value=parseInt(this.value,10)))},setBindings:function(){new Evo.Binding("mutationrate",function(){return b.prototype.mutationRate},
function(a){a=parseFloat(a);a=Math.max(a,0);a=Math.min(a,1);b.prototype.mutationRate=a});new Evo.Binding("mutationfactor",function(){return 1/b.prototype.mutationFactor},function(a){a=parseFloat(1/a);a=Math.max(a,1E-5);a=Math.min(a,1E3);b.prototype.mutationFactor=a})}};return b}();
Evo.EnergyGenerator=function(){var b=function(a,b){this.energyPerMillisecond=10;this.energyPerActor=this.energy=0;this.cellFactory=b;this.scene=a;this.scene.loop.registerUpdate(this);this.setBindings()};b.prototype={update:function(a){this.energy=this.energyPerMillisecond*a;this.energyPerActor=this.energy/this.cellFactory.getCellCount()},get:function(){return this.energyPerActor},setBindings:function(){new Evo.Binding("energypersecond",function(){return this.energyPerMillisecond}.bind(this),function(a){a=
parseFloat(a,10);this.energyPerMillisecond=a=Math.max(a,0)}.bind(this))}};return b}();Evo=Evo||{};
Evo.Grid=function(){var b=function(a,b,c,e,f){this.scene=a;this.gridWidth=b;this.gridHeight=c;this.pixelWidth=e;this.pixelHeight=f;this.nodeLength=0;this.scene.loop.registerDraw(this);this.create()};b.prototype={create:function(){var a=this.gridWidth,b=this.gridHeight;for(this.gridNodes=[];a--;)for(this.gridNodes[a]=Array(this.gridHeight),b=this.gridHeight;b--;)this.gridNodes[a][b]=new Evo.GridNode},destroy:function(){for(var a=this.gridWidth,b=this.gridHeight;a--;){for(b=this.gridHeight;b--;)this.gridNodes[a][b].destroy();this.gridNodes[a].length=
0}this.gridNodes.length=0;this.gridNodes=null},emptyAllItems:function(){for(var a=this.gridWidth,b=this.gridHeight;a--;)for(b=this.gridHeight;b--;)this.gridNodes[a][b].empty();this.nodeLength=0},resize:function(a,b){this.pixelWidth=a;this.pixelHeight=b;this.emptyAllItems()},removeItems:function(a){for(var b=a.length;b--;)this.removeItem(a[b]),this.nodeLength--},removeItem:function(a){a.gridNode&&(a.gridNode.remove(a),this.nodeLength--)},updateItem:function(a,b,c){b=this.pixelsToGridNode(b,c);b!==
a.gridNode&&(a.gridNode&&(a.gridNode.remove(a),this.nodeLength--),b.add(a),this.nodeLength++)},draw:function(a){a=this.gridWidth;var b=this.gridHeight,c,e,f=this.pixelWidth/this.gridWidth,g=this.pixelHeight/this.gridHeight;for(this.scene.canvas.context.strokeStyle="rgba(0,50,0,0.2)";a--;)for(b=this.gridHeight;b--;)this.scene.canvas.context.fillStyle="rgba(0,110,255,"+Math.min(0.2,0.5*this.gridNodes[a][b].length()/(this.nodeLength+1))+")",c=a/this.gridWidth*this.pixelWidth,e=b/this.gridHeight*this.pixelHeight,
this.scene.canvas.context.fillRect(c,e,f,g)},pixelsToGridNode:function(a,b){var c=this.pixelsToGridSpace(a,b);return this.gridNodes[c.x][c.y]},pixelsToGridSpace:function(a,b){var c=new Evo.Vector;c.x=Math.floor(this.gridWidth*(a/this.pixelWidth));c.y=Math.floor(this.gridHeight*(b/this.pixelHeight));c.x=Math.max(c.x,0);c.y=Math.max(c.y,0);c.x=Math.min(c.x,this.gridWidth-1);c.y=Math.min(c.y,this.gridWidth-1);return c},pixelsToItems:function(a,d){var c=b.pixelsToGridSpace(a,d);return this.gridNodes[c.x][c.y].getAllItems()},
pixelsAndGridRadiusToItems:function(a,d,c){b.pixelsToGridSpace(a,d);d=a=-1*c;for(var e=[];a<=c;){for(;d<=c;)e.concat(this.gridNodes[a][d].getAllItems()),d++;a++}return e}};return b}();
Evo.GridNode=function(){var b=function(){this._nodeStack=[]};b.prototype={add:function(a){return-1===this._nodeStack.indexOf(a)?(this._nodeStack.push(a),a.gridNode=this,!0):!1},remove:function(a){this._nodeStack.splice(this._nodeStack.indexOf(a),1);a.gridNode=null},getAllItems:function(){return this._nodeStack.slice(0)},length:function(){return this._nodeStack.length},destroy:function(){this._nodeStack.length=0},empty:function(){this.destroy()}};return b}();Evo=Evo||{};
Evo.Scene=function(){var b=function(){$("document").ready(this.onReady.bind(this))};b.prototype={onReady:function(){this.ui=new Evo.UI;this.loop=new Evo.Loop(this);this.canvas=new Evo.Canvas(this.loop);this.mouse=new Evo.Mouse(this,this.canvas);this.cellFactory=new Evo.CellFactory(this);Evo.States.GrowAndDivide.prototype.setBindings();Evo.Binding.prototype.hashToModel();Evo.Vector.is3d&&(Evo.ExtendSceneTo3d(b.prototype),this.setup3d(),this.loop.registerDraw(this));this.cellFactory.generateCells();this.loop.start()}};
return b}();
Evo.ExtendSceneTo3d=function(b){$.extend(b,{setup3d:function(){this.renderer=void 0;this.div=document.getElementById("evo");this.scene=new THREE.Scene;this.camera=new THREE.PerspectiveCamera(50,this.canvas.width/this.canvas.height,1,3E3);this.camera.position.x=(this.canvas.width+this.canvas.height)/4;this.camera.position.y=(this.canvas.width+this.canvas.height)/4;this.camera.position.z=(this.canvas.width+this.canvas.height)/4;console.log(this.camera.position);this.controls=new THREE.OrbitControls(this.camera,this.canvas.el);
this.addRenderer();this.addLights();this.addGrid();this.addEventListeners()},addLights:function(){this.lights=[];this.lights[0]=new THREE.AmbientLight(16777215);this.lights[1]=new THREE.PointLight(16777215,1,0);this.lights[2]=new THREE.PointLight(16777215,1,0);this.lights[3]=new THREE.PointLight(16777215,1,0);this.lights[1].position.set(0,200,0);this.lights[2].position.set(100,200,100);this.lights[3].position.set(-100,-200,-100);this.scene.add(this.lights[1]);this.scene.add(this.lights[2]);this.scene.add(this.lights[3])},
addGrid:function(){for(var a=new THREE.LineBasicMaterial({color:12632304}),b=new THREE.Geometry,c=0;40>=c;c++)b.vertices.push(new THREE.Vector3(-500,-75,25*c-500)),b.vertices.push(new THREE.Vector3(500,-75,25*c-500)),b.vertices.push(new THREE.Vector3(25*c-500,-75,-500)),b.vertices.push(new THREE.Vector3(25*c-500,-75,500));this.grid=new THREE.Line(b,a,THREE.LinePieces);this.scene.add(this.grid);this.grid.scale.multiplyScalar(3)},addRenderer:function(){this.renderer=new THREE.WebGLRenderer({canvas:this.canvas.el});
this.renderer.setSize(this.canvas.width,this.canvas.height);this.div.appendChild(this.renderer.domElement)},addEventListeners:function(){$(window).on("resize",this.resizeHandler.bind(this))},resizeHandler:function(){console.log("resizing");this.camera.aspect=this.canvas.width/this.canvas.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.canvas.width,this.canvas.height)},draw:function(){this.controls.update();this.renderer.render(this.scene,this.camera)}})};var evo=new Evo.Scene;
Evo.Loop=function(){var b=function(a){this.scene=a;this._animationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setInterval(a,1E3/60)};this._isPlaying=!1;this._updateListeners=[];this._drawListeners=[];this._dt=this._timePast=this._timePresent=this._dI=this._uI=this._drawLength=this._updateLength=0;$("#Loop-Pause").on("mouseup",this.pauseHandler.bind(this))};
b.prototype={registerUpdate:function(a){this._updateListeners.push(a);this._updateLength=this._updateListeners.length},registerDraw:function(a){this._drawListeners.push(a);this._drawLength=this._drawListeners.length},removeUpdate:function(a){a=this._updateListeners.indexOf(a);0<=a&&(this._updateListeners.splice(a,1),this._updateLength--)},removeDraw:function(a){a=this._drawListeners.indexOf(a);0<=a&&(this._drawListeners.splice(a,1),this._drawLength--)},updateTime:function(){this._timePresent=(new Date).getTime();
this._dt=Math.min(this._timePresent-this._timePast,500);this._timePast=this._timePresent},runUpdateListeners:function(a){for(this._uI=0;this._uI<this._updateLength;++this._uI)this._updateListeners[this._uI].update(a)},runDrawListeners:function(a){for(this._dI=0;this._dI<this._drawLength;++this._dI)this._drawListeners[this._dI].draw(a)},mainLoop:function(){this._isPlaying&&this._animationFrame.call(window,this.mainLoop.bind(this),this.scene.canvas.el);this.updateTime();this.runUpdateListeners(this._dt);
this.runDrawListeners(this._dt)},pauseHandler:function(a){a&&a.preventDefault();this._isPlaying?($("#Loop-Pause").val("Play"),this.stop()):($("#Loop-Pause").val("Pause"),this.start());$.uniform.update("#Loop-Pause")},start:function(){this._isPlaying=!0;this._timePast=(new Date).getTime();this.mainLoop()},stop:function(){this._isPlaying=!1}};return b}();
Evo.Canvas=function(){var b=function(a){this.loop=a;this.ratio=1<=window.devicePixelRatio?window.devicePixelRatio:1;this.$el=$("canvas");this.el=this.$el.get(0);Evo.Vector.is3d||(this.context=this.el.getContext("2d"),this.loop.registerDraw(this));this.resize();$(window).on("resize",this.resize.bind(this))};b.prototype={resize:function(a){768>$(window).width()?this.el.width=$(window).width()*this.ratio:this.el.width=($(window).width()-$(".menu").outerWidth())*this.ratio;this.el.height=$(window).height()*
this.ratio;this.width=this.el.width;this.height=this.el.height;this.left=this.$el.offset().left;this.top=this.$el.offset().top;a&&this.loop&&(this.loop.runUpdateListeners(0),this.loop.runDrawListeners(0))},draw:function(){this.context.clearRect(0,0,this.width,this.height)}};return b}();
Evo.Mouse=function(){var b=function(a,b){this.position=new Evo.Vector(-1E4,-1E4);this.canvas=b;this.scene=a;this.drawRadius=100;document.addEventListener("mousemove",this.onMouseMove.bind(this));document.addEventListener("touchmove",this.onTouchMove.bind(this));document.addEventListener("touchend",this.onTouchEnd.bind(this));document.ontouchstart=function(a){a.preventDefault()}};b.prototype={draw:function(){this.canvas.context.strokeStyle="rgba(140,0,0,0.4)";this.canvas.context.arc(this.position.x,
this.position.y,this.drawRadius,0,2*Math.PI,!1);this.canvas.context.lineWidth=5;this.canvas.context.stroke()},onMouseMove:function(a){"number"===typeof a.pageX&&a.pageX>this.canvas.left?(this.position.x=a.pageX-this.canvas.left,this.position.y=a.pageY-this.canvas.top):(this.position.x=-1E5,this.position.y=-1E5)},onTouchMove:function(a){a.touches&&(this.position.x=a.touches[0].pageX-this.canvas.left,this.position.y=a.touches[0].pageY-this.canvas.top)},onTouchEnd:function(a){this.position.x=-1E5;this.position.y=
-1E5},setDrawRadius:function(a){this.drawRadius=a},getPosition:function(){return this.position},getX:function(){return this.position.x},getY:function(){return this.position.y}};return b}();Evo.Utilities={extend:function(b,a){$().extend(b.prototype,b.prototype,a.prototype);b.prototype.parent=a},rgbToFillstyle:function(b,a,d,c){return void 0===c?["rgb(",b,",",a,",",d,")"].join(""):["rgba(",b,",",a,",",d,",",c,")"].join("")}};Evo.Utilities.Examples={};
Evo.Utilities.Examples.Parent=function(){var b=function(a){this.name=a;console.log(this.name+" creating parent")};b.prototype={scold:function(){console.log(this.name+" parent is scolding")}};return b}();Evo.Utilities.Examples.Child=function(){var b=function(a){this.parent.call(this,a);console.log(this.name+" creating child")};b.prototype={whine:function(){console.log(this.name+" child is whining")}};Evo.Utilities.extend(b,Evo.Utilities.Examples.Parent);return b}();Evo=Evo||{};
Evo.Vector2=function(){var b=function(a,b){this.x=a||0;this.y=b||0};b.is2d=!0;b.is3d=!1;b.prototype.clone=function(){return new Evo.Vector(this.x,this.y)};b.prototype.copy=function(a){this.x=a.x;this.y=a.y};b.prototype.multiplyScalar=function(a){"number"===typeof a?(this.x*=a,this.y*=a):(this.x*=a.x,this.y*=a.y);return this};b.prototype.divide=function(a){"number"===typeof a?(this.x/=a,this.y/=a):(this.x/=a.x,this.y/=a.y);return this};b.prototype.add=function(a){"number"===typeof a?(this.x+=a,this.y+=
a):(this.x+=a.x,this.y+=a.y);return this};b.prototype.subtract=function(a){"number"===typeof a?(this.x-=a,this.y-=a):(this.x-=a.x,this.y-=a.y);return this};b.prototype.abs=function(){Math.abs(this.x);Math.abs(this.y);return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.length=function(){return Math.sqrt(this.dot(this))};b.prototype.distanceTo=function(a){a=a.clone();a.subtract(this);return a.length()};b.prototype.lengthSqr=function(){return this.dot(this)};b.prototype.lerp=
function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this};b.prototype.normalize=function(){if(0!==this.x||0!==this.y){var a=this.length();this.x/=a;this.y/=a}return this};return b}();Evo.Vector=function(){THREE.Vector3.is2d=!1;THREE.Vector3.is3d=!0;return THREE.Vector3}();
Evo.VMath=function(){return{multiplyScalar:function(b,a){var d=b.clone();d.multiply(a);return d},divide:function(b,a){var d=b.clone();d.divide(a);return d},add:function(b,a){var d=b.clone();d.add(a);return d},subtract:function(b,a){var d=b.clone();d.subtract(a);return d},abs:function(b){b=b.clone();b.abs();return b},dot:function(b,a){return vector.dot(a)},length:function(b){return Math.sqrt(b.dot(b))},distance:function(b,a){var d=b.clone();d.subtract(a);return d.length()},lengthSqr:function(b){return b.dot(b)},
lerp:function(b,a,d){b=b.clone();b.lerp(a,d);return b},normalize:function(b){b=b.clone();b.normalize();return b()}}}();Evo.Random=function(){function b(a){this.seed=a||10}b.prototype={get:function(a,b){return Math.random()},getInt:function(a,b){return parseInt(this.get(a,b),10)}};return b}();Evo=Evo||{};
Evo.StateMachine=function(){var b=function(){this.currentStates=[]};b.prototype={update:function(a){for(var b in this.currentStates)this.currentStates[b].update(a)},add:function(a){if(!(0<=this.currentStates.indexOf(a))){if("function"===typeof a.onAdd)a.onAdd();a.stateMachine=this;this.currentStates.push(a)}},remove:function(a){a=this.currentStates.indexOf(a);if(0<=a){if("function"===typeof this.currentStates[a])this.currentStates[a].onRemove();this.currentStates[a].stateMachine=null;this.currentStates.splice(a,
1)}},has:function(a){return 0<=this.currentStates.indexOf(a)},kill:function(){for(var a;a<this.currentStates.length;++a)this.currentStates[a].actor=null,"function"===typeof this.currentStates[a].kill&&this.currentStates[a].kill();this.currentStates.length=0}};return b}();Evo.States={};
Evo.States.Roam=function(){var b=function(a){this.actor=a;this.speed=0.05;this.direction=new Evo.Vector;this.direction.x=2*Math.random()-1;this.direction.y=2*Math.random()-1;Evo.Vector.is3d&&(this.direction.z=2*Math.random()-1)};b.prototype.update=function(){this.direction.x=Math.min((Math.random()-0.5)/10+this.direction.x,1);this.direction.y=Math.min((Math.random()-0.5)/10+this.direction.y,1);Evo.Vector.is3d&&(this.direction.z=Math.min((Math.random()-0.5)/10+this.direction.z,1));this.actor.addWeightedDirection(this.direction,
1);this.actor.addWeightedSpeed(this.speed,1)};return b}();Evo.States.FleeWalls=function(b,a){return Evo.Vector.is2d?new Evo.States.FleeWalls2d(b,a):new Evo.States.FleeWalls3d(b,a)};
Evo.States.FleeWalls2d=function(){var b=function(a,b){this.actor=a;this.canvas=b;this.MARGIN=(this.canvas.width+this.canvas.height)/4;this.direction=new Evo.Vector;this.weight=0};b.prototype.update=function(){this.direction.multiplyScalar(0);this.actor.position.x<this.MARGIN&&(this.direction.x=(this.MARGIN-this.actor.position.x)/this.MARGIN);this.actor.position.y<this.MARGIN&&(this.direction.y=(this.MARGIN-this.actor.position.y)/this.MARGIN);this.actor.position.x>this.canvas.width-this.MARGIN&&(this.direction.x=
-1*((this.MARGIN-(this.canvas.width-this.actor.position.x))/this.MARGIN));this.actor.position.y>this.canvas.height-this.MARGIN&&(this.direction.y=-1*((this.MARGIN-(this.canvas.height-this.actor.position.y))/this.MARGIN));if(0!==this.direction.x||0!==this.direction.y)this.weight=this.direction.x*this.direction.x+this.direction.y*this.direction.y,this.direction.normalize(),this.actor.addWeightedDirection(this.direction,2*this.weight)};return b}();
Evo.States.FleeWalls3d=function(){var b=function(a,b){this.actor=a;this.canvas=b;this.MARGIN=0;this.origin=new THREE.Vector3(0,0,0);this.direction=new THREE.Vector3(0,0,0);this.distance=0;this.fleeStarts=100;this.fleeEnds=300;this.fleeMargin=this.fleeEnds-this.fleeStarts;this.direction=new THREE.Vector3(0,0,0);this.weight=0};b.prototype.update=function(){this.distance=this.origin.distanceTo(this.actor.position);this.distance>this.fleeStarts&&(this.direction.copy(this.actor.position).normalize().negate(),
this.weight=this.direction.x*this.direction.x+this.direction.y*this.direction.y+this.direction.z*this.direction.z,this.actor.addWeightedDirection(this.direction,1*this.weight))};b.prototype.onAdd=function(){};b.prototype.onRemove=function(){};return b}();
Evo.States.Boids2d=function(){var b=function(a){Evo.Vector.is3d&&console.warn("Boids are not 3d capable");this.actor=a;this.speed=0.05;this.neighborsDirection=new Evo.Vector(0,0);this.neighborsPosition=new Evo.Vector(0,0);this.neighborsPositionSum=new Evo.Vector(0,0);this.direction=new Evo.Vector(2*Math.random()-1,2*Math.random()-1)};b.prototype.update=function(){if(this.actor.gridNode){var a=this.actor.gridNode._nodeStack,b=0,c=a.length;this.neighborsDirection.x=0;for(this.neighborsDirection.y=0;b<
c;b++)this.neighborsDirection.x+=a[b].direction.x,this.neighborsDirection.y+=a[b].direction.y,this.neighborsPosition.x=a[b].position.x-this.actor.position.x,this.neighborsPosition.y=a[b].position.y-this.actor.position.x,this.neighborsPosition.normalize(),this.neighborsPositionSum.add(this.neighborsPosition);0<c&&this.neighborsPositionSum.divide(c);(0<this.neighborsDirection.x||0<this.neighborsDirection.y)&&this.neighborsDirection.normalize();this.actor.addWeightedDirection(this.neighborsDirection,
0.01);this.actor.addWeightedDirection(this.neighborsPositionSum,1)}};b.prototype.onAdd=function(){};b.prototype.onRemove=function(){};return b}();
Evo.States.FleeMouse2d=function(){var b=function(a,b,c,e){this.actor=a;this.mouse=b;this.direction=void 0;this.speed=this.distanceToMouse=0;this.maxWeight=2;this.weight=0;this.fleeSpeed=c;this.fleeDistance=e;this.prevDirection=new Evo.Vector(0,0,0);this.prevSpeed=0;this.interpolationAmount=1};b.prototype.update=function(a){this.direction=Evo.VMath.subtract(this.actor.position,this.mouse.getPosition());this.distanceToMouse=this.direction.length();this.speed=Math.max(0,this.fleeDistance-this.distanceToMouse)/
this.fleeSpeed;this.weight=Math.max(0,this.fleeDistance-this.distanceToMouse)/this.fleeDistance*this.maxWeight;this.interpolationAmount=Math.min(1,1-a/500);this.speed+=(this.prevSpeed-this.speed)*this.interpolationAmount;0<this.speed?(this.direction.normalize(),this.actor.addWeightedDirection(this.direction,this.weight),this.actor.addWeightedSpeed(this.speed,this.weight)):this.speed=0;this.prevDirection=this.direction;this.prevSpeed=this.speed};b.prototype.onAdd=function(){};b.prototype.onRemove=
function(){};return b}();
Evo.States.GrowAndDivide=function(){var b=function(a,b,c,e){this.actor=a;this.cellFactory=b;this.growthSpeed=c;this.divideSize=e};b.prototype.GROWTHFACTOR=0.05;b.prototype.update=function(a){this.actor.size+=this.actor.energy*this.GROWTHFACTOR;this.actor.energy=0;this.actor.size>this.divideSize&&(this.actor.size=this.divideSize,this.cellFactory.divideCell(this.actor))};b.prototype.onAdd=function(){};b.prototype.onRemove=function(){};b.prototype.setBindings=function(){new Evo.Binding("growthfactor",function(){return b.prototype.GROWTHFACTOR},
function(a){a=parseFloat(a,10);b.prototype.GROWTHFACTOR=a}.bind(this))};return b}();Evo.States.DieRandomly=function(){var b=function(a,b){this.actor=a;this.cellFactory=b};b.prototype.update=function(a){0.001>Math.random()&&(this.cellFactory.cellIsDead(this.actor),this.actor.kill())};b.prototype.onAdd=function(){};b.prototype.onRemove=function(){};return b}();
Evo.States.DieWhenCrowded=function(){var b=function(a,b){this.actor=a;this.cellFactory=b};b.prototype.update=function(a){Math.random()<0.3*(this.cellFactory.cells.length/this.cellFactory.maxCells)&&Math.random()<0.5*(this.actor.age/5E3)&&(this.cellFactory.cellIsDead(this.actor),this.actor.kill())};b.prototype.onAdd=function(){};b.prototype.onRemove=function(){};return b}();Evo=Evo||{};Evo.UI=function(){var b=function(){this.startUniform();this.sectionNavigator=new Evo.SectionNavigator};b.prototype={startUniform:function(){$("input, select, textarea").uniform()}};return b}();
Evo.SectionNavigator=function(){var b=function(){this.transitionSpeed=500;this.$level1=$("#level1");this.$level2=$("#level2");this.$wrapper=$(".section-wrapper");this.$wrapper.addClass("level1-showing");$(".section-navigator input[type=button]").on("mouseup",this.showLevel1.bind(this));$(".back-button-input").on("mouseup",this.showLevel2.bind(this));$("#Binding-toHash").on("mouseup",Evo.Binding.prototype.modelToHash)};b.prototype={showLevel1:function(a){a&&a.preventDefault();if(a=$(a.target).attr("data-id-show"))$("#"+
a).addClass("show"),this.$wrapper.removeClass("level1-showing"),this.$wrapper.addClass("level2-showing")},showLevel2:function(a){a&&a.preventDefault();this.$level2.find("fieldset").removeClass("show");this.$wrapper.addClass("level1-showing");this.$wrapper.removeClass("level2-showing")}};return b}();
Evo.Binding=function(){var b=function(a,d,c){this.domId=a;this.$view=$("#"+a);this.getter=d;this.setter=c;this.$view.on("change.Evo-Binding",this.updateModel.bind(this));this.updateView();b.prototype._allBindings.push(this)};b.prototype={_allBindings:[],modelToHash:function(){for(var a=b.prototype._allBindings,d=[],c=0,e=a.length;c<e;c++)d.push({name:a[c].domId,value:a[c].getViewValue()});window.location.hash="/?"+$.param(d)},hashToModel:function(){var a;a=window.location.hash.substr(3).split("&");
if(""===a)a={};else{for(var d=[],c=0;c<a.length;++c){var e=a[c].split("=");2===e.length&&d.push({name:e[0],value:decodeURIComponent(e[1].replace(/\+/g," "))})}a=d}for(var d=b.prototype._allBindings,c=0,e=a.length,f=0,g=d.length;c<e;c++)for(f=0;f<g;f++)console.log(d[f].domId,a[c].name),d[f].domId===a[c].name&&void 0!==a[c].name&&(d[f].updateView(a[c].value),d[f].updateModel())},getViewValue:function(){if(void 0!==this.$view[0])return this.$view.is("input[type='radio']")?this.$view.is(":checked").val():
this.$view.is("input")?this.$view.val():this.$view.html()},updateModel:function(){var a=this.getViewValue();this.setter(a);this.updateView()},updateView:function(a){void 0===a&&(a=this.getter());void 0!==this.$view[0]&&(this.$view.is("input[type='radio']")||(this.$view.is("input")?this.$view.val(a):this.$view.html(a)))},remove:function(){b.prototype._allBindings.splice(b.prototype._allBindings.indexOf(this),1);this.setter=this.getter=this.$view=null;this.$view.off("change.Evo-Binding",this.updateModel)}};
return b}();
